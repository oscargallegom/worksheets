<%= nested_form_for @field, :url => {:action => "update"}, :html => {:class => "nn-form"} do |f| %>

    <% if @field.errors.any? %>
        <br/>
        <div id="error_explanation" class="alert">
          <h2><%= pluralize(@field.errors.count, "error") %> encountered:</h2>

          <ul>
            <% @field.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div class="sectionRest clearfix">
      <%= hidden_field_tag :step, 4 %>

      <div>
        <fieldset>
          <ol>
            <li><h2 class='sectionHeading'>Baseline BMPs</h2></li>
            <li>All additional BMPs not captured under the Baseline Crop Management tab should be listed here.</li>

            <!-- only show if permanent pasture -->
            <% if (@field.field_type_id == 2) then %>
                <li><h2 class='sectionHeading'>Streambank fencing</h2></li>
                <li>
                  <label class="wide"><b>Pasture is adjacent to stream<em>*</em></b></label>
                  <%= f.radio_button :is_pasture_adjacent_to_stream, true, :required => true %>
                  <%= f.label :is_pasture_adjacent_to_stream_true, 'Yes' %>
                  <%= f.radio_button :is_pasture_adjacent_to_stream, false, :required => true %>
                  <%= f.label :is_pasture_adjacent_to_stream_false, 'No' %>
                </li>
                <li>
                  <%= f.label :fence_length, 'Linear feet of streabank fence:<em>*</em>'.html_safe, :class => 'wide' %>
                  <%= f.text_field :fence_length, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                </li>
                <li>
                  <label class="wide"><b>Is streambank fencing in place<em>*</em></b></label>
                  <%= f.radio_button :is_streambank_fencing_in_place, true, :required => true %>
                  <%= f.label :is_streambank_fencing_in_place_true, 'Yes' %>
                  <%= f.radio_button :is_streambank_fencing_in_place, false, :required => true %>
                  <%= f.label :is_streambank_fencing_in_place_false, 'No' %>
                </li>
                <!-- TODO: hide if no fence -->
                <li>
                  <%= f.label :name, 'Type of vegetation between fence and stream:<em>*</em>'.html_safe, :class => 'wide' %>
                  <%= f.collection_select :vegetation_type_fence_stream_id, VegetationType.all, :id, :name, {:prompt => 'Select vegetation type'}, {:required => true} %></td>
                </li>
                <li>
                  <%= f.label :distance_fence_stream, 'Average distance betweeen fence and stream:<em>*</em>'.html_safe, :class => 'wide' %>
                  <%= f.text_field :distance_fence_stream, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                </li>
            <% end %>
            <!-- end only show if permanent pasture -->

            <!-- only show if crop or continuous hay -->
            <% if (@field.field_type_id == 1 || @field.field_type_id == 3) then %>
                <li><h2 class='sectionHeading'>Riparian/Conservation Buffer BMPs</h2></li>
                <li>Enter information if you have a riparian/conservation buffer BMP in place.
                  Note: If the nitrogen load reduction calculated for alternative watering facility is greater than that
                  for buffers, it will be used instead.
                </li>
                <li>
                  <%= f.label :is_forest_buffer, 'Forest buffer in place:', :class => 'wide' %>
                  <%= f.check_box :is_forest_buffer %>
                </li>
                <div id='div_is_forest_buffer'
                     <% if !@field.is_forest_buffer? %>style='display: none'
                <% end %> >
                  <li>
                    <%= f.label :forest_buffer_average_width, 'Average width of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <%= f.text_field :forest_buffer_average_width, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                  </li>
                  <li>
                    <%= f.label :forest_buffer_length, 'Linear feet of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <%= f.text_field :forest_buffer_length, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                  </li>
                  <li>
                    <%= f.label :forest_buffer_area, 'Area of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <input type='text' id='forest_buffer_area' value='<%= (number_with_precision(@field.forest_buffer_area, :precision => 2, :separator => '.', :delimiter => ',')) %>' disabled='disabled'>
                    ac
                  </li>
                  <li>
                    <%= f.label :is_forest_buffer_planned, 'Planned:', :class => 'wide' %>
                    <%= f.check_box :is_forest_buffer_planned %>
                    <hr/>
                  </li>
                </div>

                <li>
                  <%= f.label :is_grass_buffer, 'Grass buffer in place:', :class => 'wide' %>
                  <%= f.check_box :is_grass_buffer %>
                </li>

                <div id='div_is_grass_buffer'
                     <% if !@field.is_grass_buffer? %>style='display: none'
                <% end %> >
                  <li>
                    <%= f.label :grass_buffer_average_width, 'Average width of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <%= f.text_field :grass_buffer_average_width, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                  </li>
                  <li>
                    <%= f.label :grass_buffer_length, 'Linear feet of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <%= f.text_field :grass_buffer_length, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
                  </li>
                  <li>
                    <%= f.label :grass_buffer_area, 'Area of buffer:<em>*</em>'.html_safe, :class => 'wide' %>
                    <input type='text' id='grass_buffer_area' value='<%= (number_with_precision(@field.grass_buffer_area, :precision => 2, :separator => '.', :delimiter => ',')) %>' disabled='disabled'>
                    ac
                  </li>
                  <li>
                    <%= f.label :is_grass_buffer_planned, 'Planned:', :class => 'wide' %>
                    <%= f.check_box :is_grass_buffer_planned %>
                  </li>
                </div>

            <% end %>
            <!-- end only show if crop or continuous hay -->

            <li><h2 class='sectionHeading'>Wetland</h2></li>
            <li>
              <%= f.label :is_wetland, 'Wetland in place:', :class => 'wide' %>
              <%= f.check_box :is_wetland %>
            </li>
            <div id='div_is_wetland'
                 <% if !@field.is_wetland? %>style='display: none'
            <% end %> >
              <li>
                <%= f.label :wetland_area, 'Area of wetland:<em>*</em>'.html_safe, :class => 'wide' %>
                <%= f.text_field :wetland_area, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
              </li>
              <li>
                <%= f.label :wetland_treated_area, 'Upland area treated by wetland:<em>*</em>'.html_safe, :class => 'wide' %>
                <%= f.text_field :wetland_treated_area, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
              </li>
              <li>
                <%= f.label :is_wetland_planned, 'Planned:', :class => 'wide' %>
                <%= f.check_box :is_wetland_planned %>
              </li>
            </div>


            <li><h2 class='sectionHeading'>Best management practices</h2></li>

            <div id='div_bmp'>

              <%= f.fields_for :bmps do |bmps_form| %>
                  <%= render 'bmp_fields', :f => bmps_form, :bmp_index => @field.bmps.index(bmps_form.object) %>
              <% end %>

            </div>
            <li><%= f.link_to_add "Add BMP", :bmps, :class => 'button', :id => 'addBmpBtn', :data => {:target => "#div_bmp"} %></li>


            <li><h2 class='sectionHeading'>Streambank restauration</h2></li>
            <li>
              <%= f.label :is_streambank_restoration, 'Streambank restoration in place:', :class => 'wide' %>
              <%= f.check_box :is_streambank_restoration %>
            </li>
            <div id='div_is_streambank_restoration'
                 <% if !@field.is_streambank_restoration? %>style='display: none'
            <% end %> >
              <li>
                <%= f.label :streambank_restoration_length, 'Linear feet:<em>*</em>'.html_safe, :class => 'wide' %>
                <%= f.text_field :streambank_restoration_length, :size => 5, :type => 'number', :step => 'any', :min => 0, :required => true %> ft
              </li>
              <li>
                <%= f.label :is_streambank_restoration_planned, 'Planned:', :class => 'wide' %>
                <%= f.check_box :is_streambank_restoration_planned %>
              </li>
            </div>


          </ol>
        </fieldset>
      </div>
      <div style="clear: both"></div>

      <%= f.submit 'Save and Continue', :class => 'button' %>
    </div>
<% end %>